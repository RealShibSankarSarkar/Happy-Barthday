<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rimjhim's Surprise üéâ</title> 
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:hsl(30, 100%, 98%);
      --card:white;
      --accent:hsl(330,80%,65%);
      --accent2:hsl(280,80%,70%);
      --text:hsl(240,10%,18%);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Quicksand',sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:20px auto;padding:20px}
    .card{background:var(--card);border-radius:18px;padding:22px;box-shadow:0 12px 30px rgba(0,0,0,0.06);border:1px solid rgba(0,0,0,0.04);margin-bottom:18px}
    .header{display:flex;align-items:center;gap:20px}
    .title{
      font-family:'Pacifico',cursive;
      font-size:3rem;
      margin:0;
      color:var(--accent);
      position:relative;
      padding-right:12px;
      animation:neon 3s infinite;
      text-shadow: 0 0 6px rgba(255,112,166,0.8);
    }
    @keyframes neon{
      0%{text-shadow:0 0 6px rgba(255,112,166,0.6)}
      50%{text-shadow:0 0 28px rgba(255,112,166,0.9)}
      100%{text-shadow:0 0 6px rgba(255,112,166,0.6)}
    }
    .subtitle{font-size:1.05rem;color:var(--text);margin:0 0 0 2px}
    /* layout */
    .top-row{display:flex;gap:20px;flex-wrap:wrap}
    .left{flex:0 1 360px}
    .right{flex:1 1 560px;min-width:280px}

    /* hero image & glow */
    .hero-wrap{text-align:center}
    .hero{
      width:240px;height:240px;border-radius:50%;object-fit:cover;border:6px solid var(--accent2);
      box-shadow:0 0 50px rgba(255,156,112,0.35), 0 0 18px rgba(255,255,255,0.7) inset;
      transition:transform .35s ease, box-shadow .35s ease;
      animation:pulse 4s infinite;
    }
    @keyframes pulse{
      0%{transform:scale(1)}
      50%{transform:scale(1.04)}
      100%{transform:scale(1)}
    }

    /* shayari box */
    .shayari{background:linear-gradient(180deg, #fff, #fff);padding:16px;border-radius:12px;margin-bottom:12px;line-height:1.7;border-left:6px solid var(--accent);box-shadow:0 8px 20px rgba(0,0,0,0.04)}

    /* form */
    label{display:block;margin-top:12px;font-weight:600}
    input,textarea,select{
      width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.12);margin-top:8px;font-size:1rem;background:rgba(255,255,255,0.95)
    }
    textarea{min-height:96px;resize:vertical}
    .row{display:flex;gap:12px}
    .row .col{flex:1}

    .send-btn{margin-top:14px;padding:12px 18px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;font-weight:700;cursor:pointer;font-size:1rem;box-shadow:0 10px 24px rgba(255,112,166,0.12);transition:transform .18s}
    .send-btn:active{transform:translateY(2px)}

    /* wishes feed */
    .wishes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:16px}
    .wish-card{background:linear-gradient(180deg,#fff,#fff);padding:14px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.06);border:1px solid rgba(0,0,0,0.04)}
    .wish-meta{font-size:12px;color:gray;margin-bottom:8px}
    .wish-photo{width:100%;max-height:160px;object-fit:cover;border-radius:8px;margin-top:8px;border:1px solid rgba(0,0,0,0.05)}

    /* floating hearts */
    .hearts{position:fixed;left:0;right:0;top:0;bottom:0;pointer-events:none;overflow:hidden;z-index:5}
    .heart{position:absolute;width:18px;height:18px;background:linear-gradient(45deg,#ff8ab8,#ffd47a);transform:rotate(45deg);border-radius:3px;opacity:0.9}
    .heart:before,.heart:after{content:"";position:absolute;background:inherit;border-radius:50%}
    .heart:before{width:18px;height:18px;top:-9px;left:0}
    .heart:after{width:18px;height:18px;left:-9px;top:0}

    /* confetti canvas on top layer */
    #confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:6}

    /* music/unmute button */
    .music-control{position:fixed;right:18px;bottom:18px;z-index:9;background:white;padding:10px;border-radius:999px;box-shadow:0 10px 30px rgba(0,0,0,0.12);display:flex;gap:8px;align-items:center}
    
    /* Full-screen overlay for user interaction (MUST be on top initially) */
    #initialOverlay{
        position:fixed;left:0;top:0;width:100%;height:100%;background:var(--bg);z-index:10;
        display:flex;flex-direction:column;justify-content:center;align-items:center;
    }
    #initialButton{
        padding:20px 40px;border-radius:15px;border:none;background:linear-gradient(135deg,var(--accent),var(--accent2));
        color:white;font-weight:700;cursor:pointer;font-size:1.5rem;box-shadow:0 10px 30px rgba(255,112,166,0.3);
        transition:transform .18s;
    }
    #initialButton:active{transform:translateY(2px)}


    @media(max-width:720px){
      .title{font-size:2rem}
      .top-row{flex-direction:column}
      .left,.right{flex:1 1 auto}
      .hero{width:200px;height:200px}
    }
  </style>
</head>
<body>

<!-- Full-screen overlay for user interaction (Initial state) -->
<div id="initialOverlay">
    <h1 class="title" style="margin-bottom:40px;font-size:2.5rem;animation:none;text-shadow:none;">‡¶è‡¶ï‡¶ü‡¶ø ‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£ ‡¶ö‡¶Æ‡¶ï ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá!</h1>
    <button id="initialButton">üéâ Tap to Reveal Surprise & Play Music üéâ</button>
</div>

<!-- floating hearts container -->
<div class="hearts" id="hearts"></div>

<!-- confetti canvas -->
<canvas id="confetti"></canvas>

<div class="wrap" id="mainWrap" style="display:none;">
    <!-- Main content is now wrapped and hidden initially -->

  <div class="card header">
    <div>
      <h1 id="dynamicTitle" class="title" style="animation:none;text-shadow:none;">Rimjhim, ‡¶§‡ßã‡¶ï‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ ‡¶ú‡¶æ‡¶®‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶ü‡¶æ surprise ‡¶∞‡ßá‡¶°‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‚Ä¶ ‡¶Ü‡¶∂‡¶æ ‡¶ï‡¶∞‡¶ø ‡¶≠‡¶æ‡¶≤‡ßã ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§</h1>
      <p id="dynamicSubtitle" class="subtitle" style="display:none;"></p>
    </div>
  </div>

  <!-- COUNTDOWN TIMER SECTION (Visible after initial click, until Dec 16, 12 AM) -->
  <div id="countdownContainer" class="card" style="text-align:center;">
      <h2 style="color:var(--accent);margin-top:0">‡¶∏‡ßá‡¶á ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶§‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø</h2>
      <div id="countdownDisplay" style="font-size:2rem;font-weight:700;color:var(--text);margin: 18px 0;">Loading Timer...</div>
      <p style="margin-bottom:0;font-size:1.1rem;font-weight:600">‡ßß‡ß¨‡¶á ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞, ‡¶†‡¶ø‡¶ï ‡¶∞‡¶æ‡¶§ ‡ßß‡ß®:‡ß¶‡ß¶ ‡¶ü‡¶æ‡ßü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá‡•§</p>
  </div>
  <!-- END COUNTDOWN TIMER SECTION -->

  <!-- BIRTHDAY CONTENT (Hidden until countdown finishes) -->
  <div id="birthdayContent" style="display:none;">
    <div class="top-row">
      <div class="left card">
        <div class="hero-wrap">
          <!-- Main Hero Image (only one image) -->
          <img id="displayPhoto" class="hero" alt="Rimjhim" 
              src="https://github.com/RealShibSankarSarkar/Happy-Barthday/blob/main/Rimjhim.png?raw=true">
        </div>

        <!-- small shayari -->
        <div class="shayari" style="margin-top:18px">
          <strong style="display:block;margin-bottom:8px;color:var(--accent)">A special wish for you</strong>
          <div style="white-space:pre-wrap">
            ‡¶§‡ßã‡¶ï‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶ï‡¶ü‡¶æ ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶ø‚Äî‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ü‡¶æ ‡¶Ø‡ßá‡¶® ‡¶≠‡¶æ‡¶≤‡ßã ‡¶ï‡¶æ‡¶ü‡ßá, ‡¶π‡¶æ‡¶∏‡¶ø‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶•‡¶æ‡¶ï‡¶ø‡¶∏‡•§
          </div>
        </div>

        <!-- Music Play Button (hidden, only a fallback now) -->
        <div style="margin-top:12px;text-align:center">
          <button id="playMusicBtn" style="background:transparent;border:1px solid rgba(0,0,0,0.08);padding:8px;border-radius:10px;cursor:pointer;display:none;">
            ‚ñ∂Ô∏è Play Music
          </button>
        </div>
      </div>

      <div class="right card">
        <!-- send wish form -->
        <h3 style="margin-top:0;color:var(--accent)">Send your sweet wish</h3>

        <label for="recName">Recipient Name</label>
        <input id="recName" value="Rimjhim">

        <label for="recMsg">Your Message / Shayari</label>
        <textarea id="recMsg">üå∏ ‡¶∞‡¶ø‡¶Æ‡¶ù‡¶ø‡¶Æ ‚Äî ‡¶§‡ßã‡¶ï‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶≤‡¶ø, ‡¶π‡¶æ‡¶∏‡¶ø‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶•‡¶æ‡¶ï ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶¶‡¶ø‡¶®‡¶ü‡¶æ‡•§ Happy Birthday! üíõ</textarea>

        <div class="row">
          <div class="col" style="flex:0 0 160px">
            <label for="phone">Phone (optional)</label>
            <input id="phone" placeholder="01XXXXXXXXX">
          </div>
        </div>

        <label for="senderName">Your Name</label>
        <input id="senderName" placeholder="Your name (optional)">

        <button id="sendBtn" class="send-btn">Send Sweet Wish! üíñ</button>

        <!-- wishes feed -->
        <h4 style="margin-top:18px;color:var(--accent);">All Wishes</h4>
        <div id="wishesGrid" class="wishes-grid"></div>
      </div>
    </div>

    <div style="text-align:center;margin-top:6px;color:gray;font-size:13px">
      Designed with ‚ù§Ô∏è by your friend Shib Sankar Sarkar
    </div>
  </div>
  <!-- END BIRTHDAY CONTENT -->

</div>

<!-- floating music control -->
<div class="music-control" id="musicControl" style="display:none">
  <button id="toggleMute" title="Pause/Play">üîä</button>
  <div style="font-size:13px;color:var(--text)">Soft Music</div>
</div>

<!-- Hidden audio -->
<audio id="bgMusic" loop>
  <!-- Set volume low initially, but let user click to play/unmute -->
  <source src="https://files.catbox.moe/lnkg6v.mp3" type="audio/mpeg">
</audio>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
/* ========================
   CONFIG - keep your own
   ======================== */
const firebaseConfig = {
  apiKey: "AIzaSyBZA9tXy6D1nyR_zyWaKiq95F5sbGjWttk",
  authDomain: "girls-b8e77.firebaseapp.com",
  projectId: "girls-b8e77",
  storageBucket: "girls-b8e77.firebasestorage.app",
  messagingSenderId: "241187517416",
  appId: "1:241187517416:web:f7547d41aa147d1e52ea5d",
  measurementId: "G-R3MMN74XW8"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

/* ========================
   UI Refs
   ======================== */
const sendBtn = document.getElementById('sendBtn');
const recName = document.getElementById('recName');
const recMsg = document.getElementById('recMsg');
const senderName = document.getElementById('senderName');
const phone = document.getElementById('phone');
const wishesGrid = document.getElementById('wishesGrid');

// NEW UI Refs for Countdown
const dynamicTitle = document.getElementById('dynamicTitle');
const countdownContainer = document.getElementById('countdownContainer');
const countdownDisplay = document.getElementById('countdownDisplay');
const birthdayContent = document.getElementById('birthdayContent');
const initialOverlay = document.getElementById('initialOverlay');
const initialButton = document.getElementById('initialButton');
const mainWrap = document.getElementById('mainWrap');

let isBigBlastActive = false; // Flag for 15-minute animation/music

/* ===============
   Initial Interaction & Music Handler (FIX)
   =============== */
function startAppAndMusic() {
    // 1. Hide the Overlay and Show Main Content
    initialOverlay.style.display = 'none';
    mainWrap.style.display = 'block';

    // 2. Play Music Unmuted/Normal Volume
    bgMusic.volume = 0.6;
    bgMusic.muted = false; // Try unmuted after user click
    bgMusic.play().catch(e => {
        console.error("Music play failed even after user interaction:", e);
        // Fallback: If unmuted play fails, play muted and let user unmute.
        bgMusic.muted = true;
        bgMusic.play().catch(()=>{});
        toggleMute.innerText = 'üîà';
    });
    
    // 3. Start the regular timer or trigger reveal if time has passed
    updateCountdown();
    const timerInterval = setInterval(updateCountdown, 1000);
}
initialButton.addEventListener('click', startAppAndMusic, {once: true});


/* ===============
   Countdown Timer Logic + Testing Mode
   =============== */

const currentYear = new Date().getFullYear();
let targetDate = new Date(currentYear, 11, 16, 0, 0, 0); 
const specialEventDuration = 15 * 60 * 1000; 

const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('mode') === 'test') {
    // Set target date 10 seconds in the future for easy testing
    targetDate = new Date(new Date().getTime() + 10000); 
    console.log("TEST MODE ACTIVATED: Target set 10 seconds from now.");
}

function handleBirthdayStart() {
    // 1. Update the Main Header Text/Animation
    dynamicTitle.innerText = 'Happy Birthday, Rimjhim'; 
    dynamicTitle.style.animation = 'neon 3s infinite';
    dynamicTitle.style.textShadow = '0 0 6px rgba(255,112,166,0.8)';

    // 2. Hide Countdown and Show Main Content
    countdownContainer.style.display = 'none';
    birthdayContent.style.display = 'block';
    musicControl.style.display='flex'; 

    // Check for the 15-minute special event
    const now = new Date().getTime();
    const timeSinceTarget = now - targetDate.getTime();

    if (timeSinceTarget >= 0 && timeSinceTarget <= specialEventDuration) {
        // --- START 15-MINUTE SPECIAL EVENT (UNMUTE & CONFETTI) ---
        isBigBlastActive = true;
        
        // Ensure music is unmuted and playing
        bgMusic.muted = false;
        if(bgMusic.paused) { bgMusic.play().catch(()=>{}); }
        toggleMute.innerText = 'üîä'; 

        // Trigger Big Confetti Blast and increase heart rate
        triggerBigConfetti();
        clearInterval(heartInterval);
        heartInterval = setInterval(spawnHeart, 400); 

        // Set a timer to revert after 15 minutes
        setTimeout(() => {
            isBigBlastActive = false;
            initializeLightConfetti();
            clearInterval(heartInterval);
            heartInterval = setInterval(spawnHeart, 800);
            
            if(!bgMusic.muted){
                bgMusic.muted = true;
                toggleMute.innerText = 'üîà';
            }
            
        }, specialEventDuration - timeSinceTarget); 
        // --- END 15-MINUTE SPECIAL EVENT ---

    } else {
        // Past the special time, ensure it's playing but muted for politeness
        bgMusic.muted = true;
        if(bgMusic.paused) { bgMusic.play().catch(()=>{}); }
        toggleMute.innerText = 'üîà';
    }

    clearInterval(timerInterval); // Stop the countdown
}


function updateCountdown() {
    const now = new Date().getTime();
    let distance = targetDate.getTime() - now;

    if (distance < 0) {
        handleBirthdayStart();
        return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    countdownDisplay.innerHTML = `${days} ‡¶¶‡¶ø‡¶® : ${hours} ‡¶ò‡¶®‡ßç‡¶ü‡¶æ : ${minutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü : ${seconds} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°`;
}

// Initial check: if targetDate is already passed, skip the overlay
if (targetDate.getTime() <= new Date().getTime()) {
    // If the birthday already started, skip the overlay and start immediately
    initialOverlay.style.display = 'none';
    mainWrap.style.display = 'block';
    // Since autoplay may fail anyway, show the button as a final fallback
    initialButton.innerText = "üéâ Tap to Play Music and Load Wishes üéâ";
    initialOverlay.style.display = 'flex'; // Temporarily show to get the click
    initialButton.addEventListener('click', () => {
        initialOverlay.style.display = 'none';
        mainWrap.style.display = 'block';
        handleBirthdayStart(); // Trigger the reveal logic
    }, {once: true});
    
    // Fallback: If user never clicks, at least show the countdown area content
    // handleBirthdayStart will be called on the click.
    
}


/* ===============
   Send wish (save to Firestore)
   ================ */
sendBtn.addEventListener('click', async ()=>{
  const r = recName.value.trim() || "Rimjhim";
  const m = recMsg.value.trim();
  if(!m){ alert("‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶è‡¶ï‡¶ü‡¶æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßã ‡¶§‡ßã!"); return; }
  const p = ""; 
  const s = senderName.value.trim() || "Anonymous";
  const ph = phone.value.trim();

  sendBtn.disabled = true; sendBtn.innerText = "Sending...";

  try{
    await db.collection('messages').add({
      recipient: r,
      text: m,
      photoURL: p,
      sender: s,
      phone: ph || "",
      time: firebase.firestore.FieldValue.serverTimestamp()
    });
    sendBtn.innerText = "Sent! üéâ";
    setTimeout(()=>{ sendBtn.disabled=false; sendBtn.innerText="Send Sweet Wish! üíñ" },1200);

    // reset optional fields
    senderName.value = "";
    phone.value = "";
  }catch(err){
    alert("Error: " + err.message);
    sendBtn.disabled=false;
    sendBtn.innerText="Send Sweet Wish! üíñ";
  }
});

/* ===============
   Real-time listener: show wishes as cards
   =============== */
db.collection('messages').orderBy('time','desc').onSnapshot(snap=>{
  wishesGrid.innerHTML = '';
  snap.forEach(doc=>{
    const d = doc.data();
    const when = d.time ? new Date(d.time.seconds*1000).toLocaleString('bn-BD') : '‚Äî';
    const card = document.createElement('div'); card.className='wish-card';
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700;color:var(--accent)">${escapeHtml(d.sender||'Anonymous')}</div>
        <div style="font-size:12px;color:gray">${escapeHtml(when)}</div>
      </div>
      <div class="wish-meta">${escapeHtml(d.recipient||'Rimjhim')}</div>
      <div style="white-space:pre-wrap">${escapeHtml(d.text||'')}</div>
      ${d.photoURL && d.photoURL.length > 5 ? `<img class="wish-photo" src="${escapeHtml(d.photoURL)}" alt="wish photo">` : ''}
      ${d.phone ? `<div style="margin-top:8px;font-size:13px;color:gray">Phone: ${escapeHtml(d.phone)}</div>` : ''}
    `;
    wishesGrid.appendChild(card);
  });
});

/* escape to avoid XSS */
function escapeHtml(s){
  return String(s||"")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}

/* ===============
   Confetti (canvas) - light & big blast logic
   =============== */
const conf = document.getElementById('confetti');
const ctx = conf.getContext('2d');
function resizeCanvas(){ conf.width = innerWidth; conf.height = innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();
let confetti = [];

function initializeLightConfetti(){
  confetti.length = 0;
  for(let i=0;i<120;i++){
    confetti.push({x:Math.random()*conf.width,y:Math.random()*conf.height,
      s:Math.random()*6+4, r:Math.random()*360, v:Math.random()*1.5+0.5, c:`hsl(${Math.random()*360},80%,60%)`});
  }
}
initializeLightConfetti();

function drawConfetti(){
  ctx.clearRect(0,0,conf.width,conf.height);
  confetti.forEach(p=>{
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.r*Math.PI/180);
    ctx.fillStyle = p.c;
    ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s*0.6);
    ctx.restore();
    p.y += p.v;
    p.r += 2;
    if(p.y > conf.height + 40){ 
        if(isBigBlastActive){
            p.y = -20; p.x = Math.random()*conf.width;
        } else {
            p.y = Math.random() * conf.height * -1; p.x = Math.random()*conf.width; 
        }
    }
  });
  requestAnimationFrame(drawConfetti);
}
drawConfetti();

function triggerBigConfetti() {
    confetti.length = 0; 
    for(let i=0;i<500;i++){ 
        confetti.push({x:Math.random()*conf.width,
                       y:Math.random()*conf.height * -1, 
                       s:Math.random()*8+6, 
                       r:Math.random()*360, 
                       v:Math.random()*3+1.5, 
                       c:`hsl(${Math.random()*360},80%,60%)`});
    }
}


/* ===============
   Floating hearts generator
   =============== */
const heartsContainer = document.getElementById('hearts');
function spawnHeart(){
  const h = document.createElement('div');
  h.className = 'heart';
  const size = Math.random()*18 + 12;
  h.style.width = h.style.height = size + 'px';
  h.style.left = Math.random()*100 + '%';
  h.style.top = (90 + Math.random()*10) + '%';
  h.style.opacity = (Math.random()*0.6 + 0.4);
  heartsContainer.appendChild(h);
  const duration = (isBigBlastActive ? 3000 : 5000) + Math.random()*5000;
  h.animate([
    {transform: `translateY(0) scale(1)`, opacity:h.style.opacity},
    {transform: `translateY(-90vh) scale(1.2)`, opacity:0}
  ], {duration:duration, easing:'linear'});
  setTimeout(()=>{ h.remove(); }, duration+100);
}
let heartInterval = setInterval(spawnHeart, 800); 

/* ===============
   Music controls Toggle
   =============== */
const bgMusic = document.getElementById('bgMusic');
const musicControl = document.getElementById('musicControl');
const toggleMute = document.getElementById('toggleMute');

// toggle mute/pause
toggleMute.addEventListener('click', ()=>{
  if(bgMusic.paused){ 
    bgMusic.play(); 
    toggleMute.innerText= bgMusic.muted ? 'üîà' : 'üîä'; 
  }
  else if(bgMusic.muted){ 
    bgMusic.muted=false; 
    toggleMute.innerText='üîä'; 
  }
  else{ 
    bgMusic.muted=true; 
    toggleMute.innerText='üîà'; 
  }
});
</script>
</body>
</html>
