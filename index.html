<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday Rimjhim â€” A Special Wish</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    /* New Cute & Smooth Palette */
    :root{
      --bg:#0f0920; /* Deep Purple/Blue */
      --card:#1a1036; /* Lighter Card Background */
      --accent:#ff70a6; /* Soft Pink */
      --accent2:#ff9c70; /* Soft Peach */
      --text:#f8fafc;
      --rimjhim-accent:#ffd166; /* Gold/Yellow Highlight */
    }
    html,body{
        margin:0;
        height:100%;
        font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',sans-serif;
        background:var(--bg);
        color:var(--text);
        padding-bottom: 40px;
        background-image: radial-gradient(circle at top right, rgba(255,112,166,0.15) 0%, transparent 40%),
                          radial-gradient(circle at bottom left, rgba(255,209,102,0.15) 0%, transparent 40%);
        background-attachment: fixed;
    }
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    .card{
        background:var(--card);
        padding:30px;
        border-radius:24px;
        box-shadow:0 10px 30px rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.1);
        backdrop-filter: blur(5px);
        animation: fadeIn 0.8s ease-out;
    }
    label{display:block; margin-top:15px; font-weight:600; color:var(--rimjhim-accent);}
    input,textarea,button{
        padding:15px;
        border-radius:12px;
        border:1px solid rgba(255,255,255,0.2);
        background:rgba(0,0,0,0.3);
        color:inherit;
        width:100%;
        box-sizing:border-box;
        margin-top:8px;
        transition: all 0.3s ease;
    }
    input:focus, textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 10px rgba(255,112,166,0.5);
        outline: none;
    }
    textarea{resize:vertical; min-height: 120px;}
    button{
        cursor:pointer;
        font-weight: 700;
        letter-spacing: 0.5px;
        margin-top: 20px;
    }
    button:hover{filter:brightness(1.1); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3);}
    button:active{transform: translateY(0);}

    .flex{display:flex;gap:15px}
    .hidden{display:none}
    .msg{
        padding:18px;
        border-radius:16px;
        background:rgba(255,255,255,0.1);
        margin-top:15px;
        border-left: 5px solid var(--accent);
        transition: transform 0.2s ease;
    }
    .msg:hover{
        transform: scale(1.01);
        background: rgba(255,255,255,0.15);
    }
    .meta{font-size:12px;color:rgba(255,255,255,0.7); margin-top: 5px;}
    .footer-link{
        text-align:center;
        margin-top:30px;
        font-size: 14px;
        color:var(--rimjhim-accent);
        cursor:pointer;
        text-decoration: none;
        transition: color 0.2s;
        padding: 10px;
    }
    .footer-link:hover{text-decoration: underline; color: var(--accent);}

    /* Custom Styles for Birthday Section */
    .birthday-header{
      text-align: center;
      margin-bottom: 25px;
    }
    .birthday-header h2{
      font-family: 'Pacifico', cursive;
      font-size: 3rem;
      color: var(--rimjhim-accent);
      text-shadow: 0 0 20px rgba(255, 209, 102, 0.7);
      margin-bottom: 10px;
    }
    .hero-img-container{
      text-align: center;
      margin-bottom: 30px;
    }
    .hero-img{
      max-width: 250px;
      height: 250px; /* Enforce height for object-fit */
      border-radius: 50%;
      border: 6px solid var(--accent);
      box-shadow: 0 0 30px rgba(255, 112, 166, 0.8), 0 0 15px rgba(255,255,255,0.3) inset;
      object-fit: cover;
      transition: all 0.5s ease;
    }
    .hero-img:hover{
        transform: scale(1.05) rotate(3deg);
        box-shadow: 0 0 40px var(--accent), 0 0 25px var(--rimjhim-accent);
    }

    /* Keyframes */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
<div class="wrap">

  <!-- ---------------- Birthday Section ---------------- -->
  <div id="birthdaySection" class="card">
    <div class="birthday-header">
      <h2>Happy Birthday Rimjhim!</h2>
      <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">Send your warmest wishes!</p>
    </div>

    <!-- Prominent Image of the Birthday Girl -->
    <div class="hero-img-container">
      <img id="displayPhoto" class="hero-img" src="https://github.com/RealShibSankarSarkar/Happy-Barthday/blob/main/Rimjhim.png?raw=true" alt="Rimjhim's Picture">
    </div>

    <label for="recName">Recipient Name</label>
    <input id="recName" value="Rimjhim" placeholder="Recipient's Name">

    <label for="recMsg">Your Message / Shayari</label>
    <textarea id="recMsg" rows="4">Tomar hosh, tomar hasi,
Ei chotto dine hok sob kotha beshi.
Happy Birthday,
Ei prarthonaâ€”tomar jibon hok tomar motoi mishti.</textarea>

    <label for="recPhoto">Photo URL (optional) - Will be displayed with your wish</label>
    <!-- Changed default to the "eyes" image as a suggestion for a nice alternative, keeping the original as an option -->
    <input id="recPhoto" value="https://github.com/RealShibSankarSarkar/Happy-Barthday/blob/main/eyes21.jpeg?raw=true" placeholder="Image link here">

    <label for="senderName">Your Name (sender)</label>
    <input id="senderName" placeholder="Your name">

    <button id="saveBtn" style="background:linear-gradient(135deg,var(--accent),var(--accent2));color:var(--bg);font-size: 1.2rem;padding: 18px;">Send Magical Wish! âœ¨</button>
  </div>


  <!-- ---------------- Admin Login Section ---------------- -->
  <div id="adminLogin" class="card hidden">
    <h2>Admin Login</h2>
    <label for="adminEmail">Email</label>
    <input id="adminEmail" value="sarkarshibsankor@gmail.com">

    <label for="adminPass">Password</label>
    <input id="adminPass" type="password" value="JaiHanuman!S">

    <button id="loginBtn" style="margin-top:20px;background-color: var(--rimjhim-accent); color: var(--bg);">Login</button>

    <button id="backToBirthday" style="margin-top:10px;background-color: rgba(255,255,255,0.1);">â¬… Back to Birthday Page</button>
  </div>


  <!-- ---------------- Admin Panel Section ---------------- -->
  <div id="adminPanel" class="card hidden">
    <div class="flex" style="justify-content:space-between;align-items:center">
      <h2>All Wishes (Admin View)</h2>
      <button id="logoutBtn" style="width: auto; background-color: var(--accent); padding: 10px 20px; margin-top:0;">Logout</button>
    </div>

    <div id="messagesList"></div>
  </div>
  
  <!-- "Designed by" at the very bottom -->
  <p class="footer-link" id="adminOpen">Designed by your friend Shib Sankar Sarkar</p>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// Firebase config (You already provided)
const firebaseConfig = {
  apiKey: "AIzaSyBZA9tXy6D1nyR_zyWaKiq95F5sbGjWttk",
  authDomain: "girls-b8e77.firebaseapp.com",
  projectId: "girls-b8e77",
  storageBucket: "girls-b8e77.firebasestorage.app",
  messagingSenderId: "241187517416",
  appId: "1:241187517416:web:f7547d41aa147d1e52ea5d",
  measurementId: "G-R3MMN74XW8"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// UI sections
const birthdaySection = document.getElementById('birthdaySection');
const adminLogin = document.getElementById('adminLogin');
const adminPanel = document.getElementById('adminPanel');

// Inputs
const recName = document.getElementById('recName');
const recMsg = document.getElementById('recMsg');
const recPhoto = document.getElementById('recPhoto');
const senderName = document.getElementById('senderName');
const displayPhoto = document.getElementById('displayPhoto'); 

const saveBtn = document.getElementById('saveBtn');
const adminOpen = document.getElementById('adminOpen');
const backToBirthday = document.getElementById('backToBirthday');

const adminEmail = document.getElementById('adminEmail');
const adminPass = document.getElementById('adminPass');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const messagesList = document.getElementById('messagesList');

// Update hero image on the fly if the Recipient Photo URL changes
recPhoto.oninput = ()=>{
    if(recPhoto.value.trim()){
        displayPhoto.src = recPhoto.value.trim();
    } else {
        // Fallback to the main Rimjhim image if the input is cleared
        displayPhoto.src = "https://github.com/RealShibSankarSarkar/Happy-Barthday/blob/main/Rimjhim.png?raw=true";
    }
}

// Switch UI
function showBirthday(){ birthdaySection.classList.remove('hidden'); adminLogin.classList.add('hidden'); adminPanel.classList.add('hidden'); }
function showLogin(){ birthdaySection.classList.add('hidden'); adminLogin.classList.remove('hidden'); adminPanel.classList.add('hidden'); }
function showPanel(){ birthdaySection.classList.add('hidden'); adminLogin.classList.add('hidden'); adminPanel.classList.remove('hidden'); }

adminOpen.onclick = ()=> showLogin();
backToBirthday.onclick = ()=> showBirthday();

// Save to Firestore
saveBtn.onclick = async ()=>{
  const r = recName.value.trim();
  const m = recMsg.value.trim();
  const p = recPhoto.value.trim();
  const s = senderName.value.trim();

  if(!m){ alert("Please write a special message!"); return }

  saveBtn.disabled=true; saveBtn.innerText="Sending Wish...";

  try{
    await db.collection('messages').add({
      // Security: Store raw data, escaping happens only on display in admin panel.
      recipient:r || "Friend",
      text:m,
      photoURL:p || "",
      sender:s || "Anonymous Well-wisher",
      time: firebase.firestore.FieldValue.serverTimestamp()
    });
    saveBtn.innerText="Sent Successfully! ðŸŽ‰";
    setTimeout(()=>{saveBtn.disabled=false; saveBtn.innerText="Send Magical Wish! âœ¨"},3000);
    // Clear inputs after successful save
    recName.value = "Rimjhim";
    recMsg.value = "Tomar hosh, tomar hasi,\nEi chotto dine hok sob kotha beshi.\nHappy Birthday,\nEi prarthonaâ€”tomar jibon hok tomar motoi mishti.";
    recPhoto.value = "https://github.com/RealShibSankarSarkar/Happy-Barthday/blob/main/eyes21.jpeg?raw=true";
    senderName.value = "";
    displayPhoto.src = "https://github.com/RealShibSankarSarkar/Happy-Barthday/blob/main/Rimjhim.png?raw=true"; // Reset hero image
  } catch(e){ 
    alert("Error saving message: " + e.message); 
    saveBtn.disabled=false; saveBtn.innerText="Send Magical Wish! âœ¨" 
  }
};

// Admin Login
loginBtn.onclick = async ()=>{
  loginBtn.disabled=true; loginBtn.innerText="Logging in...";
  try{
    await auth.signInWithEmailAndPassword(adminEmail.value.trim(), adminPass.value);
    loginBtn.disabled=false; loginBtn.innerText="Login";
  }catch(e){ 
    alert("Login Failed: " + e.message); 
    loginBtn.disabled=false; loginBtn.innerText="Login" 
  }
};

logoutBtn.onclick = ()=> auth.signOut();

// Auth listener
let unsub = null;
auth.onAuthStateChanged(user=>{
  if(user){
    showPanel();

    // Realtime listener
    unsub = db.collection('messages').orderBy('time','desc').onSnapshot(snap=>{
      messagesList.innerHTML="";
      snap.forEach(doc=>{
        const d = doc.data();
        const t = d.time ? d.time.toDate().toLocaleString() : "â€”";
        messagesList.innerHTML += `
          <div class='msg'>
            <div style='font-weight:bold; color:var(--rimjhim-accent)'>${escape(d.sender)} 
            <span style="font-weight:normal; color:var(--text); margin: 0 5px;">â†’</span> 
            <span style="color:var(--accent)">${escape(d.recipient)}</span></div>
            <div class='meta'>${t}</div>
            <div style='margin-top:12px;white-space:pre-wrap;line-height:1.5'>${escape(d.text)}</div>
            ${d.photoURL ? `<img src='${escape(d.photoURL)}' style='margin-top:15px;max-width:100%;border-radius:12px;display:block;height:auto;border: 2px solid rgba(255,255,255,0.1);'>` : ''}
          </div>`;
      });
    });

  }else{
    if(unsub) unsub();
    showBirthday(); // Redirect to birthday page after logout
  }
});

// Security: Function to escape HTML special characters to prevent XSS
function escape(s){ 
    return String(s||"")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
}
</script>
</body>
</html>
