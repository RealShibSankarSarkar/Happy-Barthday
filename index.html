<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday Template ‚Äî Light & Cute</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <style>
    /* Light & Cute Palette */
    :root{
      --bg:hsl(30, 100%, 98%); /* Very Light Cream/Peach */
      --card:white; 
      --accent:hsl(330, 80%, 65%); /* Soft Pink */
      --accent2:hsl(40, 100%, 70%); /* Soft Peach/Gold */
      --text:hsl(240, 10%, 20%); /* Dark Text */
      --shadow-light: rgba(0,0,0,0.05);
    }
    html,body{
        margin:0;
        height:100%;
        font-family: 'Quicksand', sans-serif; /* Cute & Modern Font */
        background:var(--bg);
        color:var(--text);
        padding-bottom: 40px;
        background-image: radial-gradient(circle at top right, rgba(255,112,166,0.1) 0%, transparent 40%),
                          radial-gradient(circle at bottom left, rgba(255,209,102,0.1) 0%, transparent 40%);
        background-attachment: fixed;
    }
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    .card{
        background:var(--card);
        padding:30px;
        border-radius:24px;
        box-shadow:0 15px 35px var(--shadow-light); /* Soft Shadow */
        border: 1px solid rgba(0,0,0,0.05);
        animation: fadeIn 0.8s ease-out;
    }
    label{display:block; margin-top:15px; font-weight:700; color:var(--text); font-size: 0.95rem;}
    input,textarea,button{
        padding:15px;
        border-radius:12px;
        border:1px solid rgba(0,0,0,0.15);
        background:rgba(255,255,255,0.7); /* Light Input Background */
        color:var(--text);
        width:100%;
        box-sizing:border-box;
        margin-top:8px;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Smooth Springy Transition */
    }
    input:focus, textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 10px rgba(255,112,166,0.3);
        background: white;
        outline: none;
    }
    textarea{resize:vertical; min-height: 120px;}
    button{
        cursor:pointer;
        font-weight: 700;
        letter-spacing: 0.5px;
    }
    button:hover{filter:brightness(1.05); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.2);}
    button:active{transform: translateY(-1px); filter:brightness(0.95);}

    .flex{display:flex;gap:15px}
    .hidden{display:none}
    .msg{
        padding:20px;
        border-radius:18px;
        background:var(--bg); /* Lighter background for messages */
        margin-top:15px;
        border-left: 6px solid var(--accent);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .msg:hover{
        transform: scale(1.01);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .meta{font-size:12px;color:hsl(240, 10%, 40%); margin-top: 5px;}
    .footer-link{
        text-align:center;
        margin-top:30px;
        font-size: 14px;
        color:var(--text);
        cursor:pointer;
        text-decoration: none;
        transition: color 0.2s;
        padding: 10px;
    }
    .footer-link:hover{text-decoration: underline; color: var(--accent);}

    /* Custom Styles for Birthday Section */
    .birthday-header{
      text-align: center;
      margin-bottom: 25px;
    }
    .birthday-header h2{
      font-family: 'Pacifico', cursive;
      font-size: 3.5rem;
      color: var(--accent);
      text-shadow: 2px 2px 0 var(--accent2), 0 0 20px rgba(255, 112, 166, 0.5);
      margin-bottom: 10px;
    }
    .hero-img-container{
      text-align: center;
      margin-bottom: 30px;
    }
    .hero-img{
      max-width: 250px;
      height: 250px;
      border-radius: 50%;
      border: 6px solid var(--accent2);
      box-shadow: 0 0 40px rgba(255, 156, 112, 0.4), 0 0 15px rgba(255,255,255,0.8) inset;
      object-fit: cover;
      transition: all 0.5s ease;
    }

    /* Keyframes */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
<div class="wrap">

  <!-- ---------------- Birthday Section ---------------- -->
  <div id="birthdaySection" class="card">
    <div class="birthday-header">
      <h2>Happy Birthday!</h2>
      <p style="color: var(--text); font-size: 1.2rem;">Send your sweet wish to the Birthday Girl! üéÇ</p>
    </div>

    <!-- Prominent Image of the Birthday Girl (Placeholder) -->
    <div class="hero-img-container">
      <img id="displayPhoto" class="hero-img" src="PLACEHOLDER_BIRTHDAY_GIRL_MAIN_IMAGE_URL" alt="Birthday Girl's Picture">
    </div>

    <label for="recName">Recipient Name</label>
    <input id="recName" value="Birthday Girl" placeholder="e.g. Riya">

    <label for="recMsg">Your Message / Shayari</label>
    <textarea id="recMsg" rows="4">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶∏‡¶ø, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶∞‡ßç‡¶∑,
‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶π‡ßã‡¶ï ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßç‡¶∞‡ßá‡¶∑‡ßç‡¶† ‡¶¨‡¶∞‡ßç‡¶∑‡•§
Happy Birthday!
‡¶è‡¶á ‡¶ï‡¶æ‡¶Æ‡¶®‡¶æ‚Äî‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶π‡ßã‡¶ï ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã‡¶® ‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶ì ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡•§</textarea>

    <label for="recPhoto">Photo URL (optional) - The image will be displayed with your personal wish.</label>
    <input id="recPhoto" value="" placeholder="Paste your image link here">

    <label for="senderName">Your Name (sender)</label>
    <input id="senderName" placeholder="Your name">

    <button id="saveBtn" style="background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;font-size: 1.2rem;padding: 18px;border:none;">Send Sweet Wish! üíñ</button>
  </div>


  <!-- ---------------- Admin Login Section ---------------- -->
  <div id="adminLogin" class="card hidden">
    <h2>Admin Login</h2>
    <label for="adminEmail">Email</label>
    <input id="adminEmail" value="sarkarshibsankor@gmail.com">

    <label for="adminPass">Password</label>
    <input id="adminPass" type="password" value="JaiHanuman!S">

    <button id="loginBtn" style="margin-top:20px;background-color: var(--accent2); color: var(--text); border:none;">Login</button>

    <button id="backToBirthday" style="margin-top:10px;background-color: rgba(0,0,0,0.1); color: var(--text); border:none;">‚¨Ö Back to Wishes</button>
  </div>


  <!-- ---------------- Admin Panel Section ---------------- -->
  <div id="adminPanel" class="card hidden">
    <div class="flex" style="justify-content:space-between;align-items:center">
      <h2>All Wishes (Admin View)</h2>
      <button id="logoutBtn" style="width: auto; background-color: var(--accent); color: white; padding: 10px 20px; margin-top:0; border:none;">Logout</button>
    </div>

    <div id="messagesList"></div>
  </div>
  
  <!-- "Designed by" at the very bottom -->
  <p class="footer-link" id="adminOpen">Designed by your friend Shib Sankar Sarkar</p>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// Firebase config (You already provided)
const firebaseConfig = {
  apiKey: "AIzaSyBZA9tXy6D1nyR_zyWaKiq95F5sbGjWttk",
  authDomain: "girls-b8e77.firebaseapp.com",
  projectId: "girls-b8e77",
  storageBucket: "girls-b8e77.firebasestorage.app",
  messagingSenderId: "241187517416",
  appId: "1:241187517416:web:f7547d41aa147d1e52ea5d",
  measurementId: "G-R3MMN74XW8"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// UI elements
const birthdaySection = document.getElementById('birthdaySection');
const adminLogin = document.getElementById('adminLogin');
const adminPanel = document.getElementById('adminPanel');

const recName = document.getElementById('recName');
const recMsg = document.getElementById('recMsg');
const recPhoto = document.getElementById('recPhoto');
const senderName = document.getElementById('senderName');
const displayPhoto = document.getElementById('displayPhoto'); 

const saveBtn = document.getElementById('saveBtn');
const adminOpen = document.getElementById('adminOpen');
const backToBirthday = document.getElementById('backToBirthday');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const messagesList = document.getElementById('messagesList');

// Initial setup for the hero image source (User needs to replace this placeholder)
const MAIN_PHOTO_URL = "PLACEHOLDER_BIRTHDAY_GIRL_MAIN_IMAGE_URL";
displayPhoto.src = MAIN_PHOTO_URL;

// Update hero image if the Recipient Photo URL is entered
recPhoto.oninput = ()=>{
    if(recPhoto.value.trim()){
        displayPhoto.src = recPhoto.value.trim();
    } else {
        // Fallback to the main image if the input is cleared
        displayPhoto.src = MAIN_PHOTO_URL;
    }
}

// UI Switching Functions
function showBirthday(){ birthdaySection.classList.remove('hidden'); adminLogin.classList.add('hidden'); adminPanel.classList.add('hidden'); }
function showLogin(){ birthdaySection.classList.add('hidden'); adminLogin.classList.remove('hidden'); adminPanel.classList.add('hidden'); }
function showPanel(){ birthdaySection.classList.add('hidden'); adminLogin.classList.add('hidden'); adminPanel.classList.remove('hidden'); }

adminOpen.onclick = ()=> showLogin();
backToBirthday.onclick = ()=> showBirthday();

// Save to Firestore
saveBtn.onclick = async ()=>{
  const r = recName.value.trim();
  const m = recMsg.value.trim();
  const p = recPhoto.value.trim();
  const s = senderName.value.trim();

  if(!m){ alert("Please write a special message!"); return }

  saveBtn.disabled=true; saveBtn.innerText="Sending Wish...";

  try{
    await db.collection('messages').add({
      recipient:r || "Friend",
      text:m,
      photoURL:p || "",
      sender:s || "Anonymous Well-wisher",
      time: firebase.firestore.FieldValue.serverTimestamp()
    });
    saveBtn.innerText="Sent Successfully! üéâ";
    setTimeout(()=>{saveBtn.disabled=false; saveBtn.innerText="Send Sweet Wish! üíñ"},3000);
    
    // Clear dynamic inputs after successful save
    recName.value = "Birthday Girl";
    recMsg.value = "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶∏‡¶ø, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶∞‡ßç‡¶∑,\n‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶π‡ßã‡¶ï ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßç‡¶∞‡ßá‡¶∑‡ßç‡¶† ‡¶¨‡¶∞‡ßç‡¶∑‡•§\nHappy Birthday!\n‡¶è‡¶á ‡¶ï‡¶æ‡¶Æ‡¶®‡¶æ‚Äî‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶π‡ßã‡¶ï ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã‡¶® ‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶ì ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡•§";
    recPhoto.value = ""; // Clear the optional photo URL
    senderName.value = "";
    displayPhoto.src = MAIN_PHOTO_URL; // Reset hero image
  } catch(e){ 
    alert("Error saving message: " + e.message); 
    saveBtn.disabled=false; saveBtn.innerText="Send Sweet Wish! üíñ" 
  }
};

// Admin Login
loginBtn.onclick = async ()=>{
  // ... (Login logic is the same)
};

logoutBtn.onclick = ()=> auth.signOut();

// Auth listener
let unsub = null;
auth.onAuthStateChanged(user=>{
  if(user){
    showPanel();

    // Realtime listener
    unsub = db.collection('messages').orderBy('time','desc').onSnapshot(snap=>{
      messagesList.innerHTML="";
      snap.forEach(doc=>{
        const d = doc.data();
        const t = d.time ? d.time.toDate().toLocaleString() : "‚Äî";
        messagesList.innerHTML += `
          <div class='msg'>
            <div style='font-weight:bold; color:var(--accent)'>${escape(d.sender)} 
            <span style="font-weight:normal; color:var(--text); margin: 0 5px;">‚Üí</span> 
            <span style="color:var(--text)">${escape(d.recipient)}</span></div>
            <div class='meta'>${t}</div>
            <div style='margin-top:12px;white-space:pre-wrap;line-height:1.5'>${escape(d.text)}</div>
            ${d.photoURL ? `
              <div style='margin-top:10px; font-size:14px; color:var(--accent); word-break: break-all;'>
                Photo URL: ${escape(d.photoURL)} 
              </div>
              <img src='${escape(d.photoURL)}' style='margin-top:10px;max-width:100%;border-radius:12px;display:block;height:auto;border: 2px solid rgba(0,0,0,0.1);'>
            ` : ''}
          </div>`;
      });
    });

  }else{
    if(unsub) unsub();
    showBirthday();
  }
});

// Security: Function to escape HTML special characters to prevent XSS
function escape(s){ 
    return String(s||"")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
}
</script>
</body>
</html>
